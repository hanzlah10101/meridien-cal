<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <title>Mobile Calendar</title>
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --card: #111827; /* gray-900 */
        --muted: #94a3b8; /* slate-400 */
        --text: #f1f1f1; /* brighter text-200 */
        --accent: #b8860b; /* dark gold */
        --accent-dark: #b8860b; /* dark gold */
        --danger: #ef4444; /* red */
        --ring: rgba(212, 175, 55, 0.45);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans,
          Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        background: radial-gradient(
          1000px 600px at 50% -10%,
          #1f2937 0%,
          var(--bg) 50%
        );
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .app {
        width: 100%;
        max-width: 480px;
        height: 100svh;
        max-height: 860px;
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .title {
        display: flex;
        align-items: baseline;
        gap: 8px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .title .month {
        font-size: clamp(18px, 4vw, 24px);
        color: var(--accent);
        cursor: pointer;
        transition: 0.2s color;
      }
      .title .month:hover {
        color: var(--accent-dark);
        opacity: 0.8;
      }
      .title .year {
        font-size: clamp(14px, 3.3vw, 16px);
        color: var(--muted);
        background: transparent;
        border: none;
        outline: none;
        cursor: pointer;
        font-family: inherit;
        font-weight: inherit;
        padding: 0;
        margin: 0;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0 center;
        background-size: 16px;
        padding-right: 20px;
      }
      .title .year:hover {
        color: var(--accent);
      }
      .title .year:focus {
        color: var(--accent);
      }

      .btn {
        appearance: none;
        border: 1px solid transparent;
        background: #1a1a1a;
        color: var(--text);
        padding: 10px 12px;
        border-radius: 14px;
        cursor: pointer;
        box-shadow: var(--shadow);
        transition: 0.2s transform, 0.2s background, 0.2s border-color;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        display: flex;
        justify-content: center;
        text-align: center;
        align-items: center;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn:active {
        transform: translateY(0);
      }
      .btn.icon {
        padding: 10px;
        border-radius: 14px;
      }
      .btn.secondary {
        background: transparent;
        border-color: #263247;
      }
      .btn.accent {
        background: linear-gradient(135deg, var(--accent), var(--accent-dark));
        border: none;
        color: #000;
        font-weight: 700;
      }

      .calendar {
        background: #0b1220;
        border: 1px solid #1f2937;
        border-radius: var(--radius);
        padding: 12px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
        min-height: 0;
      }

      .weekdays,
      .grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .weekdays div {
        text-align: center;
        color: var(--accent);
        font-size: 12px;
        letter-spacing: 0.4px;
      }

      .cell {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 14px;
        aspect-ratio: 1/1.05;
        padding: 8px;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 6px;
        transition: 0.2s border-color, 0.2s transform;
        color: #f8f8f8;
      }
      .cell.faded {
        opacity: 0.35;
        color: aaa;
      }
      .cell.today {
        border-color: var(--accent);
        box-shadow: inset 0 0 0 2px var(--ring);
      }
      .cell .date {
        font-weight: 700;
        font-size: 14px;
        color: var(--accent);
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .cell .hijri {
        font-size: 10px !important;
        color: var(--muted) !important;
      }
      .cell .events {
        margin-top: auto;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }
      .pill {
        font-size: 10px;
        padding: 4px 6px;
        border-radius: 999px;
        background: #172036;
        border: 1px solid #263247;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 100%;
      }

      .toolbar {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }
      .nav {
        display: flex;
        gap: 6px;
      }
      .footer {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }

      /* Bottom Sheet - Simple and clean */
      .sheet {
        position: fixed;
        left: 0;
        right: 0;
        bottom: -100%;
        background: #0b1220;
        border-top: 1px solid #1f2937;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        transition: bottom 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        max-height: 75svh;
        display: flex;
        flex-direction: column;
        z-index: 1000;
        -webkit-overflow-scrolling: touch;
      }
      .sheet.open {
        bottom: 0;
      }
      .sheet-header {
        padding: 20px;
        cursor: pointer;
        user-select: none;
        flex-shrink: 0;
        touch-action: pan-y;
      }
      .sheet .drag {
        width: 90px;
        height: 5px;
        background: #334155;
        border-radius: 999px;
        margin: 0 auto;
      }
      .sheet-body {
        padding: 0 20px 20px 20px;
        overflow-y: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .sheet h3 {
        margin: 0 0 16px 0;
        font-size: 16px;
      }

      /* Enhanced overlay - Simplified */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
        transition: opacity 0.2s ease-out;
      }
      .overlay.active {
        display: block;
      }
      .sheet h3 {
        margin: 0;
        font-size: 16px;
      }
      .row {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 8px;
      }
      label {
        font-size: 14px;
        color: var(--muted);
        font-weight: 600;
        letter-spacing: 0.3px;
      }
      input,
      textarea,
      select {
        width: 100%;
        background: #0f172a;
        color: var(--text);
        border: 1px solid #263247;
        border-radius: 14px;
        padding: 16px 20px;
        font: inherit;
        outline: none;
        transition: 0.2s border-color;
        font-size: 15px;
        line-height: 1.4;
      }
      select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 20px center;
        background-size: 16px;
        padding-right: 50px;
      }
      input:focus,
      textarea:focus,
      select:focus {
        border-color: var(--accent-2);
      }
      textarea {
        min-height: 70px;
        resize: vertical;
      }
      .sheet .actions {
        display: flex;
        gap: 12px;
        justify-content: space-between;
        margin-top: 20px;
        padding-top: 16px;
        border-top: 1px solid #1f2937;
      }
      .grow {
        flex: 1;
      }
      .danger {
        background: #1a1010;
        border-color: #3a1c1c;
      }

      /* Events List */
      .events-list {
        display: flex;
        flex-direction: column;
        gap: 24px;
        margin-bottom: 20px;
        padding: 0;
      }
      .event-item {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 14px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 16px;
      }
      .event-item .content {
        flex: 1;
        min-width: 0;
      }
      .event-item .title {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 8px;
        color: var(--text);
        line-height: 1.2;
      }
      .event-item .details {
        font-size: 13px;
        color: var(--muted);
        line-height: 1.5;
        margin-bottom: 8px;
        white-space: pre-line;
      }
      .event-item .notes {
        font-size: 14px;
        color: var(--muted);
        line-height: 1.5;
        font-style: italic;
      }
      .event-item .actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 8px;
        padding-top: 12px;
        border-top: 1px solid #334155;
      }
      .event-item .btn {
        padding: 8px 16px;
        font-size: 12px;
        font-weight: 600;
        text-align: center;
        min-height: 36px;
        width: 70px;
        flex: 0 0 auto;
      }
      .event-form {
        display: none;
      }
      .event-form.show {
        display: block;
      }

      /* Table Styles for Month View */
      .table-container {
        width: 100%;
        overflow-x: auto;
        border-radius: 14px;
        box-shadow: var(--shadow);
        background: #1e293b;
        -webkit-overflow-scrolling: touch;
        /* Add scrollbar styling */
        scrollbar-width: thin;
        scrollbar-color: var(--accent) transparent;
      }
      .table-container::-webkit-scrollbar {
        height: 8px;
      }
      .table-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .table-container::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 4px;
      }
      .table-container::-webkit-scrollbar-thumb:hover {
        background: var(--accent-dark);
      }
      .events-table {
        width: 100%;
        min-width: 900px; /* Minimum width to ensure all columns are visible */
        border-collapse: collapse;
        background: #1e293b;
        margin: 0;
      }
      .events-table th,
      .events-table td {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 1px solid #334155;
        font-size: 12px;
      }
      .events-table th {
        background: #0f172a;
        color: var(--accent);
        font-weight: 700;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .events-table td {
        color: var(--text);
        vertical-align: top;
      }
      .events-table tr:hover {
        background: rgba(255, 255, 255, 0.02);
      }
      .events-table .date-col {
        white-space: nowrap;
        width: 120px;
        font-weight: 600;
        font-size: 11px;
      }
      .events-table .type-col {
        width: 80px;
        text-align: center;
      }
      .events-table .guest-col {
        width: 120px;
      }
      .events-table .pax-col {
        width: 60px;
        text-align: center;
      }
      .events-table .venue-col {
        width: 100px;
      }
      .events-table .food-col {
        width: 80px;
        text-align: center;
      }
      .events-table .time-col {
        width: 140px;
        font-size: 11px;
        white-space: nowrap;
      }
      .events-table .actions-col {
        width: 120px;
        text-align: center;
      }
      .food-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .food-badge.with-food {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }
      .food-badge.without-food {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .meal-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 4px;
      }
      .meal-badge.lunch {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
        border: 1px solid rgba(251, 191, 36, 0.3);
      }
      .meal-badge.dinner {
        background: rgba(147, 51, 234, 0.2);
        color: #9333ea;
        border: 1px solid rgba(147, 51, 234, 0.3);
      }
      .reservation-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 4px;
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .table-actions {
        display: flex;
        gap: 4px;
        justify-content: center;
      }
      .table-actions .btn {
        padding: 4px 8px;
        font-size: 10px;
        min-height: 24px;
        width: auto;
      }

      /* Small helpers */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      /* Loading states */
      .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
      }
      .loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid var(--muted);
        border-radius: 50%;
        border-top-color: var(--accent);
        animation: spin 1s linear infinite;
        z-index: 10;
      }
      .btn.loading {
        color: transparent;
      }
      .btn.loading::after {
        width: 16px;
        height: 16px;
        border-width: 2px;
      }
      @keyframes spin {
        to {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }
      .calendar.loading::after {
        width: 30px;
        height: 30px;
        border-width: 3px;
      }
      .events-list.loading::after {
        width: 25px;
        height: 25px;
        border-width: 2px;
      }

      @media (min-height: 900px) {
        .app {
          max-height: 920px;
        }
      }

      /* Responsive datetime inputs */
      .datetime-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
      }

      @media (max-width: 400px) {
        .datetime-inputs {
          grid-template-columns: 1fr;
          gap: 12px;
        }
      }

      @media (max-width: 480px) and (min-width: 401px) {
        .datetime-inputs {
          grid-template-columns: 1fr 1fr;
          gap: 8px;
        }
        .datetime-inputs input[type="date"] {
          grid-column: 1 / -1;
        }
      }

      /* Authentication & Loading Screens */
      .auth-screen,
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          1000px 600px at 50% -10%,
          #1f2937 0%,
          var(--bg) 50%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 1;
        transition: opacity 0.3s ease;
      }

      .auth-screen.hidden,
      .loading-screen.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .loading-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        text-align: center;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top-color: var(--accent);
        animation: spin 1s linear infinite;
      }

      .loading-text {
        font-size: 16px;
        color: var(--muted);
      }

      .logout-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid #263247;
        color: var(--muted);
        padding: 8px 12px;
        border-radius: 12px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .logout-btn:hover {
        background: rgba(0, 0, 0, 0.4);
        color: var(--text);
        border-color: #334155;
      }

      @media (max-width: 480px) {
        .logout-btn {
          top: 12px;
          right: 12px;
          padding: 6px 10px;
          font-size: 11px;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/localizedFormat.js"></script>
  </head>
  <body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
      </div>
    </div>

    <!-- Add overlay element -->
    <div class="overlay" id="overlay"></div>

    <!-- Logout Button -->
    <button class="logout-btn" id="logout-btn" style="display: none">
      Sign Out
    </button>

    <main
      class="app"
      aria-label="Calendar App"
      id="main-app"
      style="display: none"
    >
      <header class="bar">
        <div class="title" aria-live="polite">
          <span class="month" id="label-month">Month</span>
          <select class="year" id="label-year">
            <!-- Year options will be populated by JavaScript -->
          </select>
        </div>
        <div class="nav">
          <button
            class="btn icon secondary"
            id="prev"
            aria-label="Previous month"
          >
            ◀
          </button>
          <button class="btn icon secondary" id="next" aria-label="Next month">
            ▶
          </button>
          <button class="btn secondary" id="today">Today</button>
        </div>
      </header>
      <section class="calendar" role="grid" aria-labelledby="label-month">
        <div class="weekdays" role="row">
          <div>Sun</div>
          <div>Mon</div>
          <div>Tue</div>
          <div>Wed</div>
          <div>Thu</div>
          <div>Fri</div>
          <div>Sat</div>
        </div>
        <div class="grid" id="grid" role="rowgroup"></div>
        <div class="footer">
          <button class="btn" id="addQuick">＋ Quick Add</button>
          <div style="display: flex; gap: 8px; align-items: center">
            <label class="sr-only" for="toggle-hijri">Show Hijri</label>
            <input type="checkbox" id="toggle-hijri" />
            <span style="font-size: 12px; color: var(--muted)">Hijri</span>
          </div>
        </div>
      </section>
    </main>
    <!-- Bottom Sheet: Add/View Events -->
    <aside
      class="sheet"
      id="sheet"
      aria-hidden="true"
      aria-label="Event Editor"
    >
      <div class="sheet-header" id="sheet-header">
        <div class="drag"></div>
      </div>

      <div class="sheet-body">
        <h3 id="sheet-title">Events</h3>

        <!-- Events List -->
        <div id="events-list" class="events-list" style="display: none">
          <!-- Events will be populated here -->
        </div>
        <!-- Add Event Button -->
        <button id="add-event-btn" class="btn accent" style="display: none">
          ＋ Add Event
        </button>

        <!-- Event Form -->
        <form id="event-form" class="event-form" novalidate>
          <div class="row">
            <label for="ev-title">Title</label>
            <input id="ev-title" placeholder="e.g., Team Meeting" required />
          </div>
          <div class="row">
            <label for="ev-notes">Notes</label>
            <textarea
              id="ev-notes"
              placeholder="Details, location, etc."
            ></textarea>
          </div>
          <div class="row">
            <label for="ev-type">Type</label>
            <select id="ev-type" required>
              <option value="booking">Booking</option>
              <option value="reservation">Reservation</option>
            </select>
          </div>
          <div class="row">
            <label for="ev-meal-type">Meal Type</label>
            <select id="ev-meal-type" required>
              <option value="lunch">Lunch (12:00 PM - 4:00 PM)</option>
              <option value="dinner">Dinner (6:00 PM - 10:00 PM)</option>
            </select>
          </div>
          <div class="row">
            <label>Date & Time</label>
            <div class="datetime-inputs">
              <input id="ev-start-date" type="date" required />
              <input id="ev-start-time" type="time" required />
              <input id="ev-end-time" type="time" required />
            </div>
          </div>
          <div class="row">
            <label for="ev-guest-name">Guest Name</label>
            <input id="ev-guest-name" placeholder="e.g., John Doe" required />
          </div>
          <div class="row">
            <label for="ev-phone">Guest Phone</label>
            <input
              id="ev-phone"
              type="tel"
              placeholder="e.g., +1234567890"
              required
            />
          </div>
          <div class="row">
            <label for="ev-pax">Pax (No. of Guests)</label>
            <input
              id="ev-pax"
              type="number"
              min="1"
              placeholder="e.g., 50"
              required
            />
          </div>
          <div class="row">
            <label for="ev-venue">Venue</label>
            <select id="ev-venue" required>
              <option value="Dar-ul-Khaas">Dar-ul-Khaas</option>
              <option value="Aroos-ul-Bahar">Aroos-ul-Bahar</option>
              <option value="Grand Marquee">Grand Marquee</option>
            </select>
          </div>
          <div class="row">
            <label style="display: flex; align-items: center; gap: 8px">
              <input type="checkbox" id="ev-with-food" style="width: auto" />
              With Food
            </label>
          </div>
          <div class="actions">
            <button type="button" class="btn secondary" id="cancel">
              Cancel
            </button>
            <button type="submit" class="btn accent" id="save">Save</button>
          </div>
        </form>
      </div>
    </aside>
    <!-- Firebase Authentication and App Scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"
      import {
        getAuth,
        onAuthStateChanged,
        signOut
      } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js"

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyDAaZo9T9CVa2yTC-t6_WL4Ljy-Uce_IeE",
        authDomain: "meridien-cal.firebaseapp.com",
        databaseURL:
          "https://meridien-cal-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "meridien-cal",
        storageBucket: "meridien-cal.firebasestorage.app",
        messagingSenderId: "872918390831",
        appId: "1:872918390831:web:f262c134a3f14ee50d0eda",
        measurementId: "G-TQ3SDN7CF6"
      }

      // Initialize Firebase
      const app = initializeApp(firebaseConfig)
      const auth = getAuth(app)

      // DOM elements
      const loadingScreen = document.getElementById("loading-screen")
      const mainApp = document.getElementById("main-app")
      const logoutBtn = document.getElementById("logout-btn")

      let currentUser = null
      let authToken = null

      // Auth state observer
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          try {
            // User is signed in
            currentUser = user
            authToken = await user.getIdToken()
            localStorage.setItem("authToken", authToken)

            // Show main app, hide loading
            loadingScreen.classList.add("hidden")
            mainApp.style.display = "flex"
            logoutBtn.style.display = "block"

            // Initialize the calendar app
            if (typeof initializeCalendarApp === "function") {
              initializeCalendarApp()
            }
          } catch (error) {
            console.error("Error getting auth token:", error)
            redirectToLogin()
          }
        } else {
          // User is signed out
          currentUser = null
          authToken = null
          localStorage.removeItem("authToken")
          redirectToLogin()
        }
      })

      // Logout function
      logoutBtn.addEventListener("click", async () => {
        try {
          await signOut(auth)
        } catch (error) {
          console.error("Error signing out:", error)
        }
      })

      // Redirect to login
      function redirectToLogin() {
        window.location.href = "/login"
      }

      // Enhanced fetch function with auth
      window.authenticatedFetch = async (url, options = {}) => {
        const token = localStorage.getItem("authToken") || authToken

        if (!token) {
          throw new Error("No authentication token available")
        }

        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
          ...options.headers
        }

        const response = await fetch(url, {
          ...options,
          headers
        })

        if (response.status === 401) {
          // Token expired or invalid, redirect to login
          localStorage.removeItem("authToken")
          redirectToLogin()
          throw new Error("Authentication expired")
        }

        return response
      }

      // Make auth utilities available globally
      window.auth = auth
      window.currentUser = () => currentUser
      window.getAuthToken = () => authToken
    </script>
    <script src="index.js"></script>
  </body>
</html>
